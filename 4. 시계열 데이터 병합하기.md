# <img src = 'https://raw.githubusercontent.com/sguys99/Datascience-tips/master/src/4.1.jpg' width = 700>Data science tips
## 시계열 데이터 병합하기

<div style="text-align: right"> <b>Author : Kwang Myung Yu</b></div> 

<div style="text-align: right"> Initial upload: 2020.09.02 </div> 
<div style="text-align: right"> Last update: 2020.09.02</div> 

- 참고자료 1 : https://www.kite.com/blog/python/pandas-merge-join-concat/
- 참고자료 2 : https://towardsdatascience.com/practical-uses-of-merge-join-and-concat-8f011bbac241

<img src = 'https://raw.githubusercontent.com/sguys99/Datascience-tips/master/src/4.1.jpg' width = 700>

pandas는 다수의 데이터프레임을 병합하는데 유용한 라이브러리를 몇가지 제공한다.(concat, merge, join)  
pd.concat은 동일한 컬럼명을 가지는 다수의 데이터를 합치는데 유용하다.- 수직병합(vertical merging)에 유용  
merge와 join은 기준이 되는 키 값을 통해 데이터프레임의 컬럼을 확장할 때 유용하다. - 수평병합(horizontal merging)에 유용  



## 1. 데이터 가져오기

라이브러리 import
- 주식 일별 데이터를 가져오기 위해 `FinanceDataReader` 라이브러리를 사용한다.[[참고자료]](https://github.com/FinanceData/FinanceDataReader/blob/master/tutorial/FinanceDataReader%20Tutorial%20-%20%EC%97%AC%EB%9F%AC%20%EC%A2%85%EB%AA%A9%EC%9D%98%20%EA%B0%80%EA%B2%A9%EC%9D%84%20%ED%95%9C%EB%B2%88%EC%97%90.ipynb)  


```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.gridspec as gridspec
import seaborn as sns
import datetime
import warnings; warnings.filterwarnings('ignore')
plt.style.use('ggplot')
%matplotlib inline

import FinanceDataReader as fdr
```

철강 3사 posco(005490), 현대제철(004020), KG동부제철(016380) 데이터를 가져온다.


```python
stock1 = fdr.DataReader('005490', '2020-1-01', '2020-8-27')
stock2 = fdr.DataReader('004020', '2020-1-01', '2020-8-27')
stock3 = fdr.DataReader('016380', '2020-1-01', '2020-8-27')
```

날짜컬럼('Date')과 종목명('Company'), 종목코드('Symbol') 추가하기


```python
stock1['Date'] = stock1.index
stock2['Date'] = stock2.index
stock3['Date'] = stock3.index
```


```python
stock1 = stock1.reset_index(drop = True)
stock2 = stock2.reset_index(drop = True)
stock3 = stock3.reset_index(drop = True)
```


```python
stock1['Company'] = 'posco'
stock2['Company'] = '현대제철'
stock3['Company'] = '동부제철'
```


```python
stock1['Symbol'] = '005490'
stock2['Symbol'] = '004020'
stock3['Symbol'] = '016380'
```


```python
stock1.head(3)
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Date</th>
      <th>Company</th>
      <th>Symbol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>236000</td>
      <td>240000</td>
      <td>234500</td>
      <td>236000</td>
      <td>213578</td>
      <td>-0.002114</td>
      <td>2020-01-02</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>1</th>
      <td>237500</td>
      <td>242000</td>
      <td>236500</td>
      <td>237000</td>
      <td>273831</td>
      <td>0.004237</td>
      <td>2020-01-03</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>2</th>
      <td>234000</td>
      <td>234500</td>
      <td>230000</td>
      <td>231000</td>
      <td>217886</td>
      <td>-0.025316</td>
      <td>2020-01-06</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
  </tbody>
</table>



```python
stock2.head(3)
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Date</th>
      <th>Company</th>
      <th>Symbol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>31600</td>
      <td>31650</td>
      <td>31050</td>
      <td>31200</td>
      <td>367943</td>
      <td>-0.007949</td>
      <td>2020-01-02</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
    <tr>
      <th>1</th>
      <td>31250</td>
      <td>31450</td>
      <td>30750</td>
      <td>30800</td>
      <td>482613</td>
      <td>-0.012821</td>
      <td>2020-01-03</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30500</td>
      <td>30600</td>
      <td>29600</td>
      <td>29650</td>
      <td>639706</td>
      <td>-0.037338</td>
      <td>2020-01-06</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
  </tbody>
</table>



```python
stock3.head()
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Date</th>
      <th>Company</th>
      <th>Symbol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7910</td>
      <td>7940</td>
      <td>7500</td>
      <td>7730</td>
      <td>58776</td>
      <td>-0.008974</td>
      <td>2020-01-02</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7730</td>
      <td>7820</td>
      <td>7520</td>
      <td>7700</td>
      <td>61580</td>
      <td>-0.003881</td>
      <td>2020-01-03</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7610</td>
      <td>7710</td>
      <td>7570</td>
      <td>7700</td>
      <td>19674</td>
      <td>0.000000</td>
      <td>2020-01-06</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7630</td>
      <td>7740</td>
      <td>7630</td>
      <td>7680</td>
      <td>16573</td>
      <td>-0.002597</td>
      <td>2020-01-07</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7680</td>
      <td>7690</td>
      <td>7400</td>
      <td>7410</td>
      <td>30792</td>
      <td>-0.035156</td>
      <td>2020-01-08</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
  </tbody>
</table>


데이터 크기확인


```python
print(stock1.shape)
print(stock2.shape)
print(stock3.shape)
```

    (164, 9)
    (164, 9)
    (164, 9)



## 2. Univerate time series merging  

- 각 주식의 종가('Close')만 추출하여 series 데이터를 만든다.  
- 이 데이터들을 병합하는 방법에 대하여 설명한다. 데이터 분석에 용이한 형태여야 한다.

동일한 컬럼 정보를 가지는 univerate 데이터셋을 분석 할때는 컬럼 단위로 병합, 분석하는 것이 편하다.  
예를들어 철강업종들의 종가('Close')를 비교분석 하고 싶다면, 각 종목의 종가별로 수평병합 하면된다. 

먼저 각 종목의 종가만 추출하여 series 데이터를 만든다.


```python
series1 = stock1.set_index('Date')['Close']
series2 = stock2.set_index('Date')['Close']
series3 = stock3.set_index('Date')['Close']
```


```python
series1.head()
```


    Date
    2020-01-02    236000
    2020-01-03    237000
    2020-01-06    231000
    2020-01-07    232000
    2020-01-08    228000
    Name: Close, dtype: int64



### 2.1 pd.concat()으로 합치기  
- concat()는 기준 컬럼이나 인덱스 없이 데이터를 병합한다.


```python
Stocks_closed = pd.concat([series1, series2, series3], axis = 1 )
# axis = 0 : vertical 병합, axis = 1 : horizontal 병합
```


```python
Stocks_closed.columns = ['posco', '현대제철', '동부제철']
```


```python
Stocks_closed.head()
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>posco</th>
      <th>현대제철</th>
      <th>동부제철</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-02</th>
      <td>236000</td>
      <td>31200</td>
      <td>7730</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>237000</td>
      <td>30800</td>
      <td>7700</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>231000</td>
      <td>29650</td>
      <td>7700</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>232000</td>
      <td>29500</td>
      <td>7680</td>
    </tr>
    <tr>
      <th>2020-01-08</th>
      <td>228000</td>
      <td>28200</td>
      <td>7410</td>
    </tr>
  </tbody>
</table>
- 위 경우 각 데이터의 인덱스(날짜)가 모두 같았다.  

- 날짜가 다른 데이터를 concat()으로 병합하면 어떻게 될까?

  

길이는 같지만 날짜 구간이 다른 데이터를 만들어본다.


```python
series1 = stock1.set_index('Date').loc['2020-01-02':'2020-01-15':, 'Close']
series2 = stock2.set_index('Date').loc['2020-01-04':'2020-01-17':, 'Close']
```


```python
series1
```


    Date
    2020-01-02    236000
    2020-01-03    237000
    2020-01-06    231000
    2020-01-07    232000
    2020-01-08    228000
    2020-01-09    234000
    2020-01-10    237500
    2020-01-13    238500
    2020-01-14    242000
    2020-01-15    242000
    Name: Close, dtype: int64




```python
series2
```


    Date
    2020-01-06    29650
    2020-01-07    29500
    2020-01-08    28200
    2020-01-09    28250
    2020-01-10    28800
    2020-01-13    29350
    2020-01-14    30500
    2020-01-15    30800
    2020-01-16    30050
    2020-01-17    30050
    Name: Close, dtype: int64



pd.concat()으로 병합한다.


```python
Stocks_closed = pd.concat([series1, series2], axis = 1 )
```


```python
Stocks_closed
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Close</th>
      <th>Close</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-02</th>
      <td>236000.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>237000.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>231000.0</td>
      <td>29650.0</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>232000.0</td>
      <td>29500.0</td>
    </tr>
    <tr>
      <th>2020-01-08</th>
      <td>228000.0</td>
      <td>28200.0</td>
    </tr>
    <tr>
      <th>2020-01-09</th>
      <td>234000.0</td>
      <td>28250.0</td>
    </tr>
    <tr>
      <th>2020-01-10</th>
      <td>237500.0</td>
      <td>28800.0</td>
    </tr>
    <tr>
      <th>2020-01-13</th>
      <td>238500.0</td>
      <td>29350.0</td>
    </tr>
    <tr>
      <th>2020-01-14</th>
      <td>242000.0</td>
      <td>30500.0</td>
    </tr>
    <tr>
      <th>2020-01-15</th>
      <td>242000.0</td>
      <td>30800.0</td>
    </tr>
    <tr>
      <th>2020-01-16</th>
      <td>NaN</td>
      <td>30050.0</td>
    </tr>
    <tr>
      <th>2020-01-17</th>
      <td>NaN</td>
      <td>30050.0</td>
    </tr>
  </tbody>
</table>
- 운좋게도 성공했다.

- 그런데 concat으로 데이터프레임을 수평병합 하는 것은 위험하다.  

- 앞에서는 Date index를 기준으로 자동 병합이 되었다.

  

다음과 같은 경우는 각 데이터의 기준일이 다른 것을 인식하지 못할 것이다.


```python
series1 = pd.Series(stock1.set_index('Date').loc['2020-01-02':'2020-01-15':, 'Close'].values)
series2 = pd.Series(stock2.set_index('Date').loc['2020-01-04':'2020-01-17':, 'Close'].values)
```


```python
series1
```


    0    236000
    1    237000
    2    231000
    3    232000
    4    228000
    5    234000
    6    237500
    7    238500
    8    242000
    9    242000
    dtype: int64


```python
Stocks_closed = pd.concat([series1, series2], axis = 1 )
```


```python
Stocks_closed
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>236000</td>
      <td>29650</td>
    </tr>
    <tr>
      <th>1</th>
      <td>237000</td>
      <td>29500</td>
    </tr>
    <tr>
      <th>2</th>
      <td>231000</td>
      <td>28200</td>
    </tr>
    <tr>
      <th>3</th>
      <td>232000</td>
      <td>28250</td>
    </tr>
    <tr>
      <th>4</th>
      <td>228000</td>
      <td>28800</td>
    </tr>
    <tr>
      <th>5</th>
      <td>234000</td>
      <td>29350</td>
    </tr>
    <tr>
      <th>6</th>
      <td>237500</td>
      <td>30500</td>
    </tr>
    <tr>
      <th>7</th>
      <td>238500</td>
      <td>30800</td>
    </tr>
    <tr>
      <th>8</th>
      <td>242000</td>
      <td>30050</td>
    </tr>
    <tr>
      <th>9</th>
      <td>242000</td>
      <td>30050</td>
    </tr>
  </tbody>
</table>
- 따라서 univerate 데이터를 수평병합 할때에는 키값(on) 옵션이 있는  pd.merge를 활용하는 것이 안전하다. 

  

### 2.2 pd.merge()로 데이터 합치기


```python
series1 = stock1.set_index('Date')['Close']
series2 = stock2.set_index('Date')['Close']
series3 = stock3.set_index('Date')['Close']
```


```python
Stocks_closed = pd.merge(series1, series2, on = 'Date', how = 'left').merge(series3, on = 'Date', how ='left')
```


```python
Stocks_closed.columns = ['posco', '현대제철', '동부제철']
```


```python
Stocks_closed.head()
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>posco</th>
      <th>현대제철</th>
      <th>동부제철</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-02</th>
      <td>236000</td>
      <td>31200</td>
      <td>7730</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>237000</td>
      <td>30800</td>
      <td>7700</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>231000</td>
      <td>29650</td>
      <td>7700</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>232000</td>
      <td>29500</td>
      <td>7680</td>
    </tr>
    <tr>
      <th>2020-01-08</th>
      <td>228000</td>
      <td>28200</td>
      <td>7410</td>
    </tr>
  </tbody>
</table>


## 3. Multivariate time series merging  
- Open, High, Low, Close 컬럼 등을 포함하는 다변수 데이터를 병합한다.  
- 다음의 두가지 예가 있을 것이다.  
    - 여러 기업의 주가정보 병합  
    - 한 기업의 주가정보와 기업정보 병합
- 데이터분석에 용이한 형태여야 한다.

### 3.1 주가정보 병합 : pd.concat()을 사용한 수직(vertical) 병합

먼저 pd.concat()을 사용하여 각 종목을 수직으로 병합한다.


```python
stocks = pd.concat([stock1, stock2, stock3], axis = 0, ignore_index=True)
```


```python
stocks
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Date</th>
      <th>Company</th>
      <th>Symbol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>236000</td>
      <td>240000</td>
      <td>234500</td>
      <td>236000</td>
      <td>213578</td>
      <td>-0.002114</td>
      <td>2020-01-02</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>1</th>
      <td>237500</td>
      <td>242000</td>
      <td>236500</td>
      <td>237000</td>
      <td>273831</td>
      <td>0.004237</td>
      <td>2020-01-03</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>2</th>
      <td>234000</td>
      <td>234500</td>
      <td>230000</td>
      <td>231000</td>
      <td>217886</td>
      <td>-0.025316</td>
      <td>2020-01-06</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>3</th>
      <td>231500</td>
      <td>234500</td>
      <td>231000</td>
      <td>232000</td>
      <td>138750</td>
      <td>0.004329</td>
      <td>2020-01-07</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>4</th>
      <td>229000</td>
      <td>229500</td>
      <td>226500</td>
      <td>228000</td>
      <td>340244</td>
      <td>-0.017241</td>
      <td>2020-01-08</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>487</th>
      <td>12250</td>
      <td>12650</td>
      <td>12150</td>
      <td>12200</td>
      <td>65142</td>
      <td>-0.035573</td>
      <td>2020-08-21</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>488</th>
      <td>12400</td>
      <td>12450</td>
      <td>11800</td>
      <td>12450</td>
      <td>60127</td>
      <td>0.020492</td>
      <td>2020-08-24</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>489</th>
      <td>12350</td>
      <td>12550</td>
      <td>12200</td>
      <td>12350</td>
      <td>69823</td>
      <td>-0.008032</td>
      <td>2020-08-25</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>490</th>
      <td>12250</td>
      <td>12400</td>
      <td>11900</td>
      <td>12100</td>
      <td>67527</td>
      <td>-0.020243</td>
      <td>2020-08-26</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>491</th>
      <td>12050</td>
      <td>12050</td>
      <td>11650</td>
      <td>11700</td>
      <td>72082</td>
      <td>-0.033058</td>
      <td>2020-08-27</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
  </tbody>
</table>
<p>492 rows × 9 columns</p>


`Date` 컬럼을 기준으로 정렬한다.


```python
stocks = stocks.sort_values(by = 'Date', ascending=True, ignore_index=True)
```


```python
stocks.head(10)
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Date</th>
      <th>Company</th>
      <th>Symbol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>236000</td>
      <td>240000</td>
      <td>234500</td>
      <td>236000</td>
      <td>213578</td>
      <td>-0.002114</td>
      <td>2020-01-02</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>1</th>
      <td>31600</td>
      <td>31650</td>
      <td>31050</td>
      <td>31200</td>
      <td>367943</td>
      <td>-0.007949</td>
      <td>2020-01-02</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7910</td>
      <td>7940</td>
      <td>7500</td>
      <td>7730</td>
      <td>58776</td>
      <td>-0.008974</td>
      <td>2020-01-02</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>3</th>
      <td>237500</td>
      <td>242000</td>
      <td>236500</td>
      <td>237000</td>
      <td>273831</td>
      <td>0.004237</td>
      <td>2020-01-03</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>4</th>
      <td>31250</td>
      <td>31450</td>
      <td>30750</td>
      <td>30800</td>
      <td>482613</td>
      <td>-0.012821</td>
      <td>2020-01-03</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
    <tr>
      <th>5</th>
      <td>7730</td>
      <td>7820</td>
      <td>7520</td>
      <td>7700</td>
      <td>61580</td>
      <td>-0.003881</td>
      <td>2020-01-03</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>6</th>
      <td>234000</td>
      <td>234500</td>
      <td>230000</td>
      <td>231000</td>
      <td>217886</td>
      <td>-0.025316</td>
      <td>2020-01-06</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>7</th>
      <td>30500</td>
      <td>30600</td>
      <td>29600</td>
      <td>29650</td>
      <td>639706</td>
      <td>-0.037338</td>
      <td>2020-01-06</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7610</td>
      <td>7710</td>
      <td>7570</td>
      <td>7700</td>
      <td>19674</td>
      <td>0.000000</td>
      <td>2020-01-06</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>9</th>
      <td>29750</td>
      <td>29900</td>
      <td>29350</td>
      <td>29500</td>
      <td>450825</td>
      <td>-0.005059</td>
      <td>2020-01-07</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
  </tbody>
</table>


`Date` 컬럼을 인덱스로 설정한다.


```python
stocks = stocks.set_index('Date')
```


```python
stocks.head(10)
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Company</th>
      <th>Symbol</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-02</th>
      <td>236000</td>
      <td>240000</td>
      <td>234500</td>
      <td>236000</td>
      <td>213578</td>
      <td>-0.002114</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>2020-01-02</th>
      <td>31600</td>
      <td>31650</td>
      <td>31050</td>
      <td>31200</td>
      <td>367943</td>
      <td>-0.007949</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
    <tr>
      <th>2020-01-02</th>
      <td>7910</td>
      <td>7940</td>
      <td>7500</td>
      <td>7730</td>
      <td>58776</td>
      <td>-0.008974</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>237500</td>
      <td>242000</td>
      <td>236500</td>
      <td>237000</td>
      <td>273831</td>
      <td>0.004237</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>31250</td>
      <td>31450</td>
      <td>30750</td>
      <td>30800</td>
      <td>482613</td>
      <td>-0.012821</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>7730</td>
      <td>7820</td>
      <td>7520</td>
      <td>7700</td>
      <td>61580</td>
      <td>-0.003881</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>234000</td>
      <td>234500</td>
      <td>230000</td>
      <td>231000</td>
      <td>217886</td>
      <td>-0.025316</td>
      <td>posco</td>
      <td>005490</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>30500</td>
      <td>30600</td>
      <td>29600</td>
      <td>29650</td>
      <td>639706</td>
      <td>-0.037338</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>7610</td>
      <td>7710</td>
      <td>7570</td>
      <td>7700</td>
      <td>19674</td>
      <td>0.000000</td>
      <td>동부제철</td>
      <td>016380</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>29750</td>
      <td>29900</td>
      <td>29350</td>
      <td>29500</td>
      <td>450825</td>
      <td>-0.005059</td>
      <td>현대제철</td>
      <td>004020</td>
    </tr>
  </tbody>
</table>
- 위와 같은 형태로 데이터를 병합하면, 데이터분석이나 예측모델을 구성할 때 용이하다.   

  

예를들어 posco주식의 종가(Close)만 시각화하고 싶다면 다음과 같이 인덱싱을 하면된다.


```python
stocks.loc[stocks['Company']=='posco', 'Close'].plot(figsize = (12, 6))
plt.title('POSCO')
plt.show()
```

<img src = 'https://raw.githubusercontent.com/sguys99/Datascience-tips/master/src/4.2.jpg' width = 700>



### 3.2 주가정보와 기업정보 병합 : pd.merge(), pd.join()을 사용한 수평(horizontal) 병합

우선 `FinanceDataReader` 라이브러리로 상장기업의 정보 데이터를 받아온다.  
- KRX : KRX 종목전체 , KOSPI : KOSPI 종목 , KOSDAQ : KOSDAQ 종목


```python
krx = fdr.StockListing('KRX')
```


```python
krx.head()
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Symbol</th>
      <th>Market</th>
      <th>Name</th>
      <th>Sector</th>
      <th>Industry</th>
      <th>ListingDate</th>
      <th>SettleMonth</th>
      <th>Representative</th>
      <th>HomePage</th>
      <th>Region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>060310</td>
      <td>KOSDAQ</td>
      <td>3S</td>
      <td>특수 목적용 기계 제조업</td>
      <td>반도체 웨이퍼 캐리어</td>
      <td>2002-04-23</td>
      <td>03월</td>
      <td>박종익, 김세완 (각자 대표이사)</td>
      <td>http://www.3sref.com</td>
      <td>서울특별시</td>
    </tr>
    <tr>
      <th>1</th>
      <td>095570</td>
      <td>KOSPI</td>
      <td>AJ네트웍스</td>
      <td>산업용 기계 및 장비 임대업</td>
      <td>렌탈(파렛트, OA장비, 건설장비)</td>
      <td>2015-08-21</td>
      <td>12월</td>
      <td>윤규선, 이현우(각자대표)</td>
      <td>http://www.ajnet.co.kr</td>
      <td>서울특별시</td>
    </tr>
    <tr>
      <th>2</th>
      <td>006840</td>
      <td>KOSPI</td>
      <td>AK홀딩스</td>
      <td>기타 금융업</td>
      <td>지주사업</td>
      <td>1999-08-11</td>
      <td>12월</td>
      <td>채형석, 이석주(각자 대표이사)</td>
      <td>http://www.aekyunggroup.co.kr</td>
      <td>서울특별시</td>
    </tr>
    <tr>
      <th>3</th>
      <td>054620</td>
      <td>KOSDAQ</td>
      <td>APS홀딩스</td>
      <td>기타 금융업</td>
      <td>인터넷 트래픽 솔루션</td>
      <td>2001-12-04</td>
      <td>12월</td>
      <td>정기로</td>
      <td>http://www.apsholdings.co.kr</td>
      <td>경기도</td>
    </tr>
    <tr>
      <th>4</th>
      <td>265520</td>
      <td>KOSDAQ</td>
      <td>AP시스템</td>
      <td>특수 목적용 기계 제조업</td>
      <td>디스플레이 제조 장비</td>
      <td>2017-04-07</td>
      <td>12월</td>
      <td>김영주</td>
      <td>http://www.apsystems.co.kr</td>
      <td>경기도</td>
    </tr>
  </tbody>
</table>
- 위 기업정보를 주가정보와 수평병합 할 것이다.

  

merge와 join은 데이터프레임을 수평으로 합치기 위한 데이터이다.  
두 라이브러리는 유사하게 동작한다. join을 사용하면 하위에서 merge가 동작한다. 

join이든 merge이든 데이터를 병합할 때 how 옵션을 잘 사용해야 한다.  
how의 주요 옵션인 `left`, `Right`, `Inner`, `Outer`의 특징은 다음과 같다.  
- Left : 첫번째 DF는 유지한 상태에서, 두번째 DF의 컬럼 정보를 병합한다.  
- Right : Left의 반대  
- Inner : 상호 겹치는 부분만 유지한다. 따라서 NaN 값이 없다.  
- Outer : 모든 열을 남긴다.  

위 네가지 옵션은 SQL의 join 과도 같다.  
**주의 :** merge의 how 디펄트는 inner이고, join의 how 디펄트는 left이다.  



#### pd.merge()를 사용한 병합

posco 주가정보와 기업정보 데이터를 병합해본다. 병합할 때 종목코드(Symbol)를 기준으로 한다.


```python
stock1_merged = stock1.merge(krx[['Symbol', 'Sector', 'Region']], on = 'Symbol', how = 'left')
```


```python
stock1_merged = stock1_merged.set_index('Date')
```


```python
stock1_merged.head()
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Company</th>
      <th>Symbol</th>
      <th>Sector</th>
      <th>Region</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-02</th>
      <td>236000</td>
      <td>240000</td>
      <td>234500</td>
      <td>236000</td>
      <td>213578</td>
      <td>-0.002114</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>237500</td>
      <td>242000</td>
      <td>236500</td>
      <td>237000</td>
      <td>273831</td>
      <td>0.004237</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>234000</td>
      <td>234500</td>
      <td>230000</td>
      <td>231000</td>
      <td>217886</td>
      <td>-0.025316</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>231500</td>
      <td>234500</td>
      <td>231000</td>
      <td>232000</td>
      <td>138750</td>
      <td>0.004329</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
    <tr>
      <th>2020-01-08</th>
      <td>229000</td>
      <td>229500</td>
      <td>226500</td>
      <td>228000</td>
      <td>340244</td>
      <td>-0.017241</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
  </tbody>
</table>


#### pd.join()을 사용한 병합

merge를 사용한 방법과 유사하다. 단 키 값을 인덱스로 설정해야 한다.


```python
stock1_merged = stock1.merge(krx[['Symbol', 'Sector', 'Region']].set_index('Symbol'), on = 'Symbol', how = 'left')
```


```python
stock1_merged = stock1_merged.set_index('Date')
```


```python
stock1_merged.head()
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Company</th>
      <th>Symbol</th>
      <th>Sector</th>
      <th>Region</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-02</th>
      <td>236000</td>
      <td>240000</td>
      <td>234500</td>
      <td>236000</td>
      <td>213578</td>
      <td>-0.002114</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>237500</td>
      <td>242000</td>
      <td>236500</td>
      <td>237000</td>
      <td>273831</td>
      <td>0.004237</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>234000</td>
      <td>234500</td>
      <td>230000</td>
      <td>231000</td>
      <td>217886</td>
      <td>-0.025316</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>231500</td>
      <td>234500</td>
      <td>231000</td>
      <td>232000</td>
      <td>138750</td>
      <td>0.004329</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
    <tr>
      <th>2020-01-08</th>
      <td>229000</td>
      <td>229500</td>
      <td>226500</td>
      <td>228000</td>
      <td>340244</td>
      <td>-0.017241</td>
      <td>posco</td>
      <td>005490</td>
      <td>1차 철강 제조업</td>
      <td>경상북도</td>
    </tr>
  </tbody>
</table>


## 4. Case study : 풍력 관련주 데이터셋 만들기

기업정보 데이터 불러오기


```python
krx = fdr.StockListing('KRX')
```


```python
krx.head()
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Symbol</th>
      <th>Market</th>
      <th>Name</th>
      <th>Sector</th>
      <th>Industry</th>
      <th>ListingDate</th>
      <th>SettleMonth</th>
      <th>Representative</th>
      <th>HomePage</th>
      <th>Region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>060310</td>
      <td>KOSDAQ</td>
      <td>3S</td>
      <td>특수 목적용 기계 제조업</td>
      <td>반도체 웨이퍼 캐리어</td>
      <td>2002-04-23</td>
      <td>03월</td>
      <td>박종익, 김세완 (각자 대표이사)</td>
      <td>http://www.3sref.com</td>
      <td>서울특별시</td>
    </tr>
    <tr>
      <th>1</th>
      <td>095570</td>
      <td>KOSPI</td>
      <td>AJ네트웍스</td>
      <td>산업용 기계 및 장비 임대업</td>
      <td>렌탈(파렛트, OA장비, 건설장비)</td>
      <td>2015-08-21</td>
      <td>12월</td>
      <td>윤규선, 이현우(각자대표)</td>
      <td>http://www.ajnet.co.kr</td>
      <td>서울특별시</td>
    </tr>
    <tr>
      <th>2</th>
      <td>006840</td>
      <td>KOSPI</td>
      <td>AK홀딩스</td>
      <td>기타 금융업</td>
      <td>지주사업</td>
      <td>1999-08-11</td>
      <td>12월</td>
      <td>채형석, 이석주(각자 대표이사)</td>
      <td>http://www.aekyunggroup.co.kr</td>
      <td>서울특별시</td>
    </tr>
    <tr>
      <th>3</th>
      <td>054620</td>
      <td>KOSDAQ</td>
      <td>APS홀딩스</td>
      <td>기타 금융업</td>
      <td>인터넷 트래픽 솔루션</td>
      <td>2001-12-04</td>
      <td>12월</td>
      <td>정기로</td>
      <td>http://www.apsholdings.co.kr</td>
      <td>경기도</td>
    </tr>
    <tr>
      <th>4</th>
      <td>265520</td>
      <td>KOSDAQ</td>
      <td>AP시스템</td>
      <td>특수 목적용 기계 제조업</td>
      <td>디스플레이 제조 장비</td>
      <td>2017-04-07</td>
      <td>12월</td>
      <td>김영주</td>
      <td>http://www.apsystems.co.kr</td>
      <td>경기도</td>
    </tr>
  </tbody>
</table>



```python
krx = krx.dropna(how = 'any')
```



기업정보에서 `풍력` 문구를 포함하는 산업군을 인덱싱한다.


```python
krx[krx['Industry'].str.contains('풍력')]
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Symbol</th>
      <th>Market</th>
      <th>Name</th>
      <th>Sector</th>
      <th>Industry</th>
      <th>ListingDate</th>
      <th>SettleMonth</th>
      <th>Representative</th>
      <th>HomePage</th>
      <th>Region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1230</th>
      <td>297090</td>
      <td>KOSDAQ</td>
      <td>씨에스베어링</td>
      <td>일반 목적용 기계 제조업</td>
      <td>풍력용 선회베어링, 산업용 선회베어링</td>
      <td>2019-11-21</td>
      <td>12월</td>
      <td>조만제, 방성훈</td>
      <td>http://www.cs-bearing.co.kr</td>
      <td>경상남도</td>
    </tr>
    <tr>
      <th>1231</th>
      <td>112610</td>
      <td>KOSPI</td>
      <td>씨에스윈드</td>
      <td>구조용 금속제품, 탱크 및 증기발생기 제조업</td>
      <td>풍력발전타워 제조</td>
      <td>2014-11-27</td>
      <td>12월</td>
      <td>김성권, 김승범</td>
      <td>http://www.cswind.com</td>
      <td>충청남도</td>
    </tr>
    <tr>
      <th>1641</th>
      <td>018000</td>
      <td>KOSDAQ</td>
      <td>유니슨</td>
      <td>일반 목적용 기계 제조업</td>
      <td>풍력발전기, 풍력타워</td>
      <td>1996-01-10</td>
      <td>12월</td>
      <td>허화도</td>
      <td>http://www.unison.co.kr</td>
      <td>경상남도</td>
    </tr>
    <tr>
      <th>2234</th>
      <td>119500</td>
      <td>KOSDAQ</td>
      <td>포메탈</td>
      <td>기타 금속 가공제품 제조업</td>
      <td>자동차,풍력,방위산업,산업기계,농기계등의 단조부품</td>
      <td>2010-09-17</td>
      <td>12월</td>
      <td>오호석</td>
      <td>http://www.formetal.co.kr</td>
      <td>충청남도</td>
    </tr>
  </tbody>
</table>


해당기업의 이름('Name')과 종목코드('Symbol')만 추출한다.


```python
code = krx[krx['Industry'].str.contains('풍력')][['Name', 'Symbol']]
```



위 정보를 바탕으로 주가정보를 받는다.


```python
stocks = pd.DataFrame()
for name, symbol in zip(code['Name'], code['Symbol']):
    stock = fdr.DataReader(symbol, '2020-1-01', '2020-8-27')
    stock['Date'] = stock.index
    stock = stock.reset_index(drop = True)
    stock['Symbol'] = symbol
    stock['Company'] = name
    stocks = pd.concat([stocks, stock], axis = 0, ignore_index=True) 
```



날짜를 기준으로 데이터를 정렬한다.


```python
stocks = stocks.sort_values(by = 'Date', ascending=True, ignore_index=True)
```


```python
stocks.head(20)
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Date</th>
      <th>Symbol</th>
      <th>Company</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8550</td>
      <td>8840</td>
      <td>8550</td>
      <td>8650</td>
      <td>165273</td>
      <td>0.018846</td>
      <td>2020-01-02</td>
      <td>297090</td>
      <td>씨에스베어링</td>
    </tr>
    <tr>
      <th>1</th>
      <td>37800</td>
      <td>37800</td>
      <td>37000</td>
      <td>37350</td>
      <td>42689</td>
      <td>-0.017105</td>
      <td>2020-01-02</td>
      <td>112610</td>
      <td>씨에스윈드</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2925</td>
      <td>2935</td>
      <td>2900</td>
      <td>2920</td>
      <td>81614</td>
      <td>-0.003413</td>
      <td>2020-01-02</td>
      <td>119500</td>
      <td>포메탈</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1005</td>
      <td>1020</td>
      <td>1000</td>
      <td>1015</td>
      <td>516471</td>
      <td>0.009950</td>
      <td>2020-01-02</td>
      <td>018000</td>
      <td>유니슨</td>
    </tr>
    <tr>
      <th>4</th>
      <td>37450</td>
      <td>38750</td>
      <td>37450</td>
      <td>38100</td>
      <td>47462</td>
      <td>0.020080</td>
      <td>2020-01-03</td>
      <td>112610</td>
      <td>씨에스윈드</td>
    </tr>
    <tr>
      <th>5</th>
      <td>8680</td>
      <td>8760</td>
      <td>8420</td>
      <td>8570</td>
      <td>177648</td>
      <td>-0.009249</td>
      <td>2020-01-03</td>
      <td>297090</td>
      <td>씨에스베어링</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1020</td>
      <td>1020</td>
      <td>1000</td>
      <td>1010</td>
      <td>383921</td>
      <td>-0.004926</td>
      <td>2020-01-03</td>
      <td>018000</td>
      <td>유니슨</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2920</td>
      <td>2960</td>
      <td>2900</td>
      <td>2915</td>
      <td>121102</td>
      <td>-0.001712</td>
      <td>2020-01-03</td>
      <td>119500</td>
      <td>포메탈</td>
    </tr>
    <tr>
      <th>8</th>
      <td>38000</td>
      <td>39050</td>
      <td>37450</td>
      <td>38500</td>
      <td>80918</td>
      <td>0.010499</td>
      <td>2020-01-06</td>
      <td>112610</td>
      <td>씨에스윈드</td>
    </tr>
    <tr>
      <th>9</th>
      <td>8490</td>
      <td>8570</td>
      <td>8260</td>
      <td>8300</td>
      <td>88846</td>
      <td>-0.031505</td>
      <td>2020-01-06</td>
      <td>297090</td>
      <td>씨에스베어링</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2920</td>
      <td>2955</td>
      <td>2890</td>
      <td>2915</td>
      <td>94121</td>
      <td>0.000000</td>
      <td>2020-01-06</td>
      <td>119500</td>
      <td>포메탈</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1000</td>
      <td>1005</td>
      <td>985</td>
      <td>1005</td>
      <td>364747</td>
      <td>-0.004950</td>
      <td>2020-01-06</td>
      <td>018000</td>
      <td>유니슨</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2910</td>
      <td>2925</td>
      <td>2870</td>
      <td>2895</td>
      <td>106705</td>
      <td>-0.006861</td>
      <td>2020-01-07</td>
      <td>119500</td>
      <td>포메탈</td>
    </tr>
    <tr>
      <th>13</th>
      <td>38650</td>
      <td>39100</td>
      <td>38250</td>
      <td>38850</td>
      <td>38676</td>
      <td>0.009091</td>
      <td>2020-01-07</td>
      <td>112610</td>
      <td>씨에스윈드</td>
    </tr>
    <tr>
      <th>14</th>
      <td>8350</td>
      <td>8480</td>
      <td>8120</td>
      <td>8400</td>
      <td>138854</td>
      <td>0.012048</td>
      <td>2020-01-07</td>
      <td>297090</td>
      <td>씨에스베어링</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1005</td>
      <td>1065</td>
      <td>1000</td>
      <td>1045</td>
      <td>2040994</td>
      <td>0.039801</td>
      <td>2020-01-07</td>
      <td>018000</td>
      <td>유니슨</td>
    </tr>
    <tr>
      <th>16</th>
      <td>38800</td>
      <td>38800</td>
      <td>36900</td>
      <td>37650</td>
      <td>55207</td>
      <td>-0.030888</td>
      <td>2020-01-08</td>
      <td>112610</td>
      <td>씨에스윈드</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2910</td>
      <td>3615</td>
      <td>2905</td>
      <td>3480</td>
      <td>9684105</td>
      <td>0.202073</td>
      <td>2020-01-08</td>
      <td>119500</td>
      <td>포메탈</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1025</td>
      <td>1040</td>
      <td>988</td>
      <td>999</td>
      <td>1411695</td>
      <td>-0.044019</td>
      <td>2020-01-08</td>
      <td>018000</td>
      <td>유니슨</td>
    </tr>
    <tr>
      <th>19</th>
      <td>8720</td>
      <td>9190</td>
      <td>7980</td>
      <td>7990</td>
      <td>1012170</td>
      <td>-0.048810</td>
      <td>2020-01-08</td>
      <td>297090</td>
      <td>씨에스베어링</td>
    </tr>
  </tbody>
</table>


주가정보와 종목정보를 수평병합한다.


```python
stocks_merged = stocks.merge(krx[['Symbol', 'Sector', 'Region']], on = 'Symbol', how = 'left')
```



인덱스를 날짜로 설정한다.


```python
stocks = stocks_merged.set_index('Date')
```


```python
stocks.head(10)
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Change</th>
      <th>Symbol</th>
      <th>Company</th>
      <th>Sector</th>
      <th>Region</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-02</th>
      <td>8550</td>
      <td>8840</td>
      <td>8550</td>
      <td>8650</td>
      <td>165273</td>
      <td>0.018846</td>
      <td>297090</td>
      <td>씨에스베어링</td>
      <td>일반 목적용 기계 제조업</td>
      <td>경상남도</td>
    </tr>
    <tr>
      <th>2020-01-02</th>
      <td>37800</td>
      <td>37800</td>
      <td>37000</td>
      <td>37350</td>
      <td>42689</td>
      <td>-0.017105</td>
      <td>112610</td>
      <td>씨에스윈드</td>
      <td>구조용 금속제품, 탱크 및 증기발생기 제조업</td>
      <td>충청남도</td>
    </tr>
    <tr>
      <th>2020-01-02</th>
      <td>2925</td>
      <td>2935</td>
      <td>2900</td>
      <td>2920</td>
      <td>81614</td>
      <td>-0.003413</td>
      <td>119500</td>
      <td>포메탈</td>
      <td>기타 금속 가공제품 제조업</td>
      <td>충청남도</td>
    </tr>
    <tr>
      <th>2020-01-02</th>
      <td>1005</td>
      <td>1020</td>
      <td>1000</td>
      <td>1015</td>
      <td>516471</td>
      <td>0.009950</td>
      <td>018000</td>
      <td>유니슨</td>
      <td>일반 목적용 기계 제조업</td>
      <td>경상남도</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>37450</td>
      <td>38750</td>
      <td>37450</td>
      <td>38100</td>
      <td>47462</td>
      <td>0.020080</td>
      <td>112610</td>
      <td>씨에스윈드</td>
      <td>구조용 금속제품, 탱크 및 증기발생기 제조업</td>
      <td>충청남도</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>8680</td>
      <td>8760</td>
      <td>8420</td>
      <td>8570</td>
      <td>177648</td>
      <td>-0.009249</td>
      <td>297090</td>
      <td>씨에스베어링</td>
      <td>일반 목적용 기계 제조업</td>
      <td>경상남도</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>1020</td>
      <td>1020</td>
      <td>1000</td>
      <td>1010</td>
      <td>383921</td>
      <td>-0.004926</td>
      <td>018000</td>
      <td>유니슨</td>
      <td>일반 목적용 기계 제조업</td>
      <td>경상남도</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>2920</td>
      <td>2960</td>
      <td>2900</td>
      <td>2915</td>
      <td>121102</td>
      <td>-0.001712</td>
      <td>119500</td>
      <td>포메탈</td>
      <td>기타 금속 가공제품 제조업</td>
      <td>충청남도</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>38000</td>
      <td>39050</td>
      <td>37450</td>
      <td>38500</td>
      <td>80918</td>
      <td>0.010499</td>
      <td>112610</td>
      <td>씨에스윈드</td>
      <td>구조용 금속제품, 탱크 및 증기발생기 제조업</td>
      <td>충청남도</td>
    </tr>
    <tr>
      <th>2020-01-06</th>
      <td>8490</td>
      <td>8570</td>
      <td>8260</td>
      <td>8300</td>
      <td>88846</td>
      <td>-0.031505</td>
      <td>297090</td>
      <td>씨에스베어링</td>
      <td>일반 목적용 기계 제조업</td>
      <td>경상남도</td>
    </tr>
  </tbody>
</table>